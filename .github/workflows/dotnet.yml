# This workflow will build a .NET project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-net

name: Deploy documentation

on:
  push:
    branches: [ "master" ]
    paths-ignore:
     - '.gitignore'
permissions:
  pull-requests: write
  deployments: write
  contents: write
  checks: read

jobs:
  Build:
    environment:
      name: github-pages
      url: 'https://adeola-aderibigbe.github.io/AdeNoteAPI/html'
    runs-on: ubuntu-latest
   
    steps:
    - uses: actions/checkout@v3
    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 6.0.x  
    - name: build test coverage xml
      run: dotnet test AdeNote.Tests/AdeNote.Tests.csproj --collect:"XPlat Code Coverage"
    - name: Generate code coverage report
      uses: im-open/code-coverage-report-generator@4.9.2  
      with:
        reports: "AdeNote.Tests/TestResults/**/coverage.cobertura.xml"
        targetdir: "Docs/coverage"
        reporttypes: 'Html;MarkdownSummary'
        title: 'AdeNote Code Coverage'
        tag: '${{ github.workflow}}_${{ github.run_id }}'
        filefilters: '-Startup.cs;-Program.cs;'
        toolpath: 'reportgeneratortool'
    - name: Deploy code coverage to gh-page
      uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: Add recent code coverage
        branch: gh-pages
        file_pattern: 'Docs/coverage/*.html Docs/coverage/*.svg Docs/coverage/*.js Docs/coverage/*.css'
        push_options: '--force'
        commit_options: '--no-verify --signoff'
    - name: Deploy to git pages
      id: deployment
      uses: DenverCoder1/doxygen-github-pages-action@v1.3.0
      with:
        folder: Docs/html
        config_file: Docs/AdeNote_Configuration.config
        github_token: ${{secrets.GITHUB_TOKEN}}
        branch: gh-pages


        
